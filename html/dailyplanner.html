<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Daily Planner</title>
  <link rel="stylesheet" href="css/dailyplanner.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
  <h1>Daily Planner</h1>
  <table>
    <tr>
      <th>Time</th>
      <th>Tasks<button onclick="redirectToTasks()">+</button></th>
      <th>Reminders</th>
      <th>Gratitude Journal<button onclick="redirectToGratitude()">+</button></th>
    </tr>
    <tr>
      <td>6:00 AM</td>
      <td id="taskCell1" class="taskcell"></td>
      <td></td>
      <td id="gratitudeCell" class="gratitudecell"></td>
    </tr>
    <tr>
      <td>7:00 AM</td>
      <td id="taskCell2" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>8:00 AM</td>
      <td id="taskCell3" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>9:00 AM</td>
      <td id="taskCell4" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>10:00 AM</td>
      <td id="taskCell5" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>11:00 AM</td>
      <td id="taskCell6" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>12:00 PM</td>
      <td id="taskCell7" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>1:00 PM</td>
      <td id="taskCell8" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>2:00 PM</td>
      <td id="taskCell9" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>3:00 PM</td>
      <td id="taskCell10" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>4:00 PM</td>
      <td id="taskCell11" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>5:00 PM</td>
      <td id="taskCell12" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>6:00 PM</td>
      <td id="taskCell13" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>7:00 PM</td>
      <td id="taskCell14" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>8:00 PM</td>
      <td id="taskCell15" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>9:00 PM</td>
      <td id="taskCell16" class="taskcell"></td>
      <td></td>
    </tr>
    <tr>
      <td>10:00 PM</td>
      <td id="taskCell17" class="taskcell"></td>
      <td></td>
    </tr>
  </table>
  <script>
    $(document).ready(function () {
      const urlParams = new URLSearchParams(window.location.search);
      const username = urlParams.get('username');
      $.ajax({
        url: `/getMostRecentGratitude?username=${username}`,
        type: 'GET',
        success: function (result) {
          $('#gratitudeCell').text(result);
        },
        error: function (error) {
          console.error(error);
        }
      });

      $.ajax({
        url: `/getTasks?username=${username}`,
        type: 'GET',
        success: function (result) {
          for (let i = 0; i < result.length; i++) {
            const task = result[i];
            const taskHours = task.hours;
            const taskStart = new Date(task.startAt).getHours();
            const taskEnd = new Date(task.endAt).getHours();

            for (let j = taskStart; j < taskEnd; j++) {
              const taskCell = $(`#taskCell${j - 10}`).text(task.task);
              if (j === taskStart) {
                taskCell.attr('rowspan', taskHours);
              } else {
                taskCell.hide();
              }
            }
          }
        },
        error: function (error) {
          console.error(error);
        }
      });

    });

    function redirectToTasks() {
      const urlParams = new URLSearchParams(window.location.search);
      const username = urlParams.get('username');
      window.location.href = `/addTasks.html?username=${username}`;
    }
    function redirectToGratitude() {
      const urlParams = new URLSearchParams(window.location.search);
      const username = urlParams.get('username');
      window.location.href = `/addGratitude.html?username=${username}`;
    }
  </script>

</html>
